/*--------------------------------*- C++ -*----------------------------------*\
  =========                 |
  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
   \\    /   O peration     | Website:  https://openfoam.org
    \\  /    A nd           | Version:  7
     \\/     M anipulation  |
-------------------------------------------------------------------------------
Description
    Calculates the normal gradient at chosen patches.

\*---------------------------------------------------------------------------*/
functionObjectLibs            ("libutilityFunctionObjects.so");

type            coded;


//Look up object: V = mesh().lookupObject<ScalarField>("V")
//Look up patch names: label = mesh().boundaryMesh().findPatchID("blach")
//Extract patch values: fvp = V.boundaryField()[label]

//Call snGrad at fvPatchField,
//Construct volVectorField PatchGrad ( IOobject (...))
//Force write IOobject to file (IOobject.write())

name E_Planar;

codeWrite
#{
	//Look up V
	//Info<< "Looking up field V:" << endl;
	const volScalarField& V = mesh().lookupObject<volScalarField>("V");

	//Look up desired patch ID
	//Info<< "Looking up Patch ID:" << endl;
	label Patch_ID = mesh().boundaryMesh().findPatchID("Planar_Electrode");

	//Look up boundary field of V at chosen patch
	const fvPatchScalarField& V_patch = V.boundaryField()[Patch_ID];

	//Pointer list of Scalar field objects of snGrad at patch cells ?????????????
	const tmp<scalarField> snGrad_V_List = V_patch.snGrad();

	const polyPatch& pp = mesh().boundaryMesh()[Patch_ID];

	//Reference list to snGrad_V_List list of objects ???????????????
	scalarField& ref = snGrad_V_List.ref();

	//Open file stream
	std::ofstream file("Electric_Field.dat",std::ios::out|std::ios::app);

	//Write current time
	file<<"Time "<<mesh().time().timeName() <<"\n";

	//Write snGrad value for each cell and co-ords of cell
	file<<"snGrad"<<"\t"<<"X"<<"\n";
	forAll(ref,face_ID){

		file<< snGrad_V_List()[face_ID] <<"\t" << pp.faceCentres()[face_ID].x() << "\t" <<"\n";

	}

	//Close file
	file.close();

#};


// ************************************************************************* //
